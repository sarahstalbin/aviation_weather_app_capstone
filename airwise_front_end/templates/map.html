{% extends 'dashboard.html' %}


{% block content %}
<!DOCTYPE html>
<main id="main">
    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h2>Map of Precipitation</h2>
            <div>
        </div>
     </section><!-- End Breadcrumbs -->          
<html>
  <head>
    <title>Simple Map</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <!-- jsFiddle will insert css and js -->
  </head>
  <body>
    <div id="map"></div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script async
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3KbYljeA9eHFq9hm_0-qKDPvNeqtiYyE&callback=initMap&libraries=&v=weekly"
    ></script>
  </body>
</html>

<script>

    // get your key from app.tomorrow.io/development/keys
    const API_KEY = '0ZQsTAdc0eMA81LFBmafbeWDbFHhF4ud'; 

    // pick the field (like temperature, precipitationIntensity or cloudCover)
    const DATA_FIELD = 'precipitationIntensity';

    // set the ISO timestamp (now for all fields, up to 6 hour out for precipitationIntensity)
    const TIMESTAMP = (new Date()).toISOString(); 

    // initialize the map
    function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 7,
        center: {
        lat:  47.60511016845703,
        lng: -122.33394622802734
        }
    });

    // inject the tile layer
    var imageMapType = new google.maps.ImageMapType({
        getTileUrl: function(coord, zoom) {
        if (zoom > 12) {
            return null;
        }

        return `https://api.tomorrow.io/v4/map/tile/${zoom}/${coord.x}/${coord.y}/${DATA_FIELD}/${TIMESTAMP}.png?apikey=${API_KEY}`;
        },
        tileSize: new google.maps.Size(256, 256)
    });

    map.overlayMapTypes.push(imageMapType);
    }

        // Load the Google Maps API     
        function loadScript() {
            const YOUR_API_KEY = 'AIzaSyC3KbYljeA9eHFq9hm_0-qKDPvNeqtiYyE';
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${YOUR_API_KEY}&callback=initMap`;
            script.defer = true;
            script.async = true;
            document.head.appendChild(script);
        }

        window.onload = loadScript;

    // CSS styles as a string
    const styles = `
                #map {
                    height: 600px;
                    witdth: 600px
                }

                html, body {
                    height: 100%;
                    margin: 0;
                    padding: 0;
                }
            `;

    // Function to inject CSS into the document head
    function injectCSS(css) {
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);
    }

    // Inject the CSS styles
    injectCSS(styles);

    </script>
</body>
</html>
{% endblock %}
